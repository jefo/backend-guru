---
# === –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è ===
title: "–ê–≥—Ä–µ–≥–∞—Ç" # H1 —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
description: "–ê–≥—Ä–µ–≥–∞—Ç ‚Äî —ç—Ç–æ –∫–ª–∞—Å—Ç–µ—Ä –¥–æ–º–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∫–∞–∫ –µ–¥–∏–Ω–æ–µ —Ü–µ–ª–æ–µ. –û–Ω –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª –≤–Ω—É—Ç—Ä–∏ —Å–≤–æ–µ–π –≥—Ä–∞–Ω–∏—Ü—ã." # –ö–æ—Ä–æ—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –ø—Ä–µ–≤—å—é-–∫–∞—Ä—Ç–æ—á–µ–∫ –∏ SEO

# === –¢–∞–∫—Å–æ–Ω–æ–º–∏—è –∏ –ù–∞–≤–∏–≥–∞—Ü–∏—è ===
section: "ddd" # –ì–ª–∞–≤–Ω—ã–π —Ä–∞–∑–¥–µ–ª (ddd, smells, clean-architecture)
category: "tactical" # –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è (strategic, tactical, etc.)

# === –í–∏–∑—É–∞–ª ===
cover: "/images/patterns/aggregate-cover.svg" # –ü—É—Ç—å –∫ –≥–ª–∞–≤–Ω–æ–π –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏–∏

# === –°–≤—è–∑–∏ (–°–µ–∫—Ä–µ—Ç–Ω—ã–π –°–æ—É—Å) ===
related:
  - "entity"
  - "value-object"
  - "repository"
  - "anemic-model" # –°—Å—ã–ª–∫–∞ –Ω–∞ "–∑–∞–ø–∞—Ö", –∫–æ—Ç–æ—Ä—ã–π —ç—Ç–æ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω –ª–µ—á–∏—Ç

# === –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ ===
published: true # true/false. –ü–æ–∑–≤–æ–ª—è–µ—Ç –¥–µ—Ä–∂–∞—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
lastUpdated: "2024-05-21"
---

# –ê–≥—Ä–µ–≥–∞—Ç

### ü§ï –ü—Ä–æ–±–ª–µ–º–∞

–†–∞–±–æ—Ç–∞—è —Å–æ —Å–ª–æ–∂–Ω–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π, –º—ã —á–∞—Å—Ç–æ —Å—Ç–∞–ª–∫–∏–≤–∞–µ–º—Å—è —Å –≥—Ä—É–ø–ø–∞–º–∏ –≤–∑–∞–∏–º–æ—Å–≤—è–∑–∞–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –∏–∑–º–µ–Ω—è—Ç—å—Å—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ. –ù–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—á–∏—Ç—ã–≤–∞—Ç—å –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –≤—Å–µ –µ–≥–æ –ø–æ–∑–∏—Ü–∏–∏, –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ª–∏–º–∏—Ç—ã, –æ–±–Ω–æ–≤–ª—è—Ç—å –∏—Ç–æ–≥–æ–≤—É—é —Å—É–º–º—É –∏ –º–Ω–æ–∂–µ—Å—Ç–≤–æ –¥—Ä—É–≥–∏—Ö –≤–∑–∞–∏–º–æ—Å–≤—è–∑–∞–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π. –≠—Ç–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–∞—Å—Ç–æ –æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Ä–∞–∑–±—Ä–æ—Å–∞–Ω—ã –ø–æ —Ä–∞–∑–Ω—ã–º —Å–ª—É–∂–±–∞–º, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö, –Ω–∞—Ä—É—à–µ–Ω–∏—é –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª –∏ —Å–ª–æ–∂–Ω–æ—Å—Ç—è–º —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∫–æ–¥–∞.

### üí° –†–µ—à–µ–Ω–∏–µ

–ê–≥—Ä–µ–≥–∞—Ç ‚Äî —ç—Ç–æ –≥—Ä—É–ø–ø–∞ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–∞–∫ –µ–¥–∏–Ω–æ–µ —Ü–µ–ª–æ–µ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö. –£ –∫–∞–∂–¥–æ–≥–æ –∞–≥—Ä–µ–≥–∞—Ç–∞ –µ—Å—Ç—å –∫–æ—Ä–µ–Ω—å (root) –∏ –≥—Ä–∞–Ω–∏—Ü–∞. –ö–æ—Ä–µ–Ω—å –∞–≥—Ä–µ–≥–∞—Ç–∞ ‚Äî —ç—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å, —á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä—É—é –≤–Ω–µ—à–Ω–∏–π –∫–æ–¥ –º–æ–∂–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏ –∞–≥—Ä–µ–≥–∞—Ç–∞. –ö–æ—Ä–µ–Ω—å –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –≥—Ä–∞–Ω–∏—Ü—ã –∞–≥—Ä–µ–≥–∞—Ç–∞.

### ‚öôÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```mermaid
classDiagram
    class Order {
        -UUID id
        -OrderItem[] items
        -OrderStatus status
        +addItem(product, quantity)
        +removeItem(itemId)
        +changeStatus(newStatus)
        +calculateTotal()
    }

    class OrderItem {
        -Product product
        -int quantity
        -calculatePrice()
    }

    class Product {
        -UUID id
        -string name
        -Money price
    }

    Order "1" *-- "0..*" OrderItem : —Å–æ–¥–µ—Ä–∂–∏—Ç
    OrderItem "1" --> "1" Product : —Å—Å—ã–ª–∞–µ—Ç—Å—è
```

### üë®‚Äçüíª –ü—Ä–∏–º–µ—Ä –≤ –∫–æ–¥–µ

```typescript
// –ö–æ—Ä–µ–Ω—å –ê–≥—Ä–µ–≥–∞—Ç–∞ - –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—É–±–ª–∏—á–Ω—ã–π –≤—Ö–æ–¥
export class Order extends AggregateRoot {
  private _id: OrderId;
  private _items: OrderItem[];
  private _status: OrderStatus;
  private _customerId: CustomerId;

  constructor(id: OrderId, customerId: CustomerId) {
    super();
    this._id = id;
    this._customerId = customerId;
    this._items = [];
    this._status = OrderStatus.Draft;
  }

  public addItem(product: Product, quantity: number): void {
    if (this._status !== OrderStatus.Draft) {
      throw new Error("Can only add items to a draft order.");
    }
    
    if (quantity <= 0) {
      throw new Error("Quantity must be positive");
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Ç–∞–∫–æ–π —Ç–æ–≤–∞—Ä –≤ –∑–∞–∫–∞–∑–µ
    const existingItem = this._items.find(item => item.productId.equals(product.id));
    
    if (existingItem) {
      existingItem.increaseQuantity(quantity);
    } else {
      const newItem = new OrderItem(
        new OrderItemId(uuidv4()), 
        this._id, 
        product.id, 
        quantity, 
        product.price
      );
      this._items.push(newItem);
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–º–µ–Ω–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ
    this.addDomainEvent(new OrderItemAddedEvent(this._id, product.id, quantity));
  }

  public removeItem(orderItemId: OrderItemId): void {
    if (this._status !== OrderStatus.Draft) {
      throw new Error("Can only remove items from a draft order.");
    }

    const itemIndex = this._items.findIndex(item => item.id.equals(orderItemId));
    
    if (itemIndex === -1) {
      throw new Error("Item not found in order");
    }
    
    const removedItem = this._items[itemIndex];
    this._items.splice(itemIndex, 1);
    
    this.addDomainEvent(new OrderItemRemovedEvent(this._id, removedItem.productId));
  }

  public submitOrder(): void {
    if (this._status !== OrderStatus.Draft) {
      throw new Error("Can only submit draft orders");
    }
    
    if (this._items.length === 0) {
      throw new Error("Cannot submit an empty order");
    }
    
    this._status = OrderStatus.Submitted;
    this.addDomainEvent(new OrderSubmittedEvent(this._id, this._customerId));
  }

  public calculateTotal(): Money {
    return this._items.reduce(
      (total, item) => total.add(item.price.multiply(item.quantity)),
      new Money(0)
    );
  }

  // –ì–µ—Ç—Ç–µ—Ä—ã –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º –¥–∞–Ω–Ω—ã–º
  get id(): OrderId { return this._id; }
  get items(): ReadonlyArray<OrderItem> { return Object.freeze([...this._items]); }
  get status(): OrderStatus { return this._status; }
  get customerId(): CustomerId { return this._customerId; }
}

// –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –æ–±—ä–µ–∫—Ç –∞–≥—Ä–µ–≥–∞—Ç–∞ Order
class OrderItem {
  private readonly _id: OrderItemId;
  private readonly _orderId: OrderId;
  private readonly _productId: ProductId;
  private _quantity: number;
  private readonly _unitPrice: Money;

  constructor(
    id: OrderItemId,
    orderId: OrderId,
    productId: ProductId,
    quantity: number,
    unitPrice: Money
  ) {
    this._id = id;
    this._orderId = orderId;
    this._productId = productId;
    this._quantity = quantity;
    this._unitPrice = unitPrice;
  }

  public increaseQuantity(quantity: number): void {
    if (quantity <= 0) {
      throw new Error("Quantity must be positive");
    }
    this._quantity += quantity;
  }

  public decreaseQuantity(quantity: number): void {
    if (quantity <= 0) {
      throw new Error("Quantity must be positive");
    }
    
    if (this._quantity - quantity < 0) {
      throw new Error("Cannot decrease quantity below zero");
    }
    
    this._quantity -= quantity;
  }

  get id(): OrderItemId { return this._id; }
  get orderId(): OrderId { return this._orderId; }
  get productId(): ProductId { return this._productId; }
  get quantity(): number { return this._quantity; }
  get unitPrice(): Money { return this._unitPrice; }
  get price(): Money { return this._unitPrice.multiply(this._quantity); }
}
```

### ‚úÖ –ö–æ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è—Ç—å (–ß–µ–∫-–ª–∏—Å—Ç)

- –ö–æ–≥–¥–∞ —É –≤–∞—Å –µ—Å—Ç—å –≥—Ä—É–ø–ø–∞ –æ–±—ä–µ–∫—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –∏–∑–º–µ–Ω—è—Ç—å—Å—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ
- –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –∑–∞—â–∏—Ç–∏—Ç—å –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã (–±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞), –∫–æ—Ç–æ—Ä—ã–µ –æ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–±—ä–µ–∫—Ç–æ–≤
- –ö–æ–≥–¥–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–∞—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–ª—è –≥—Ä—É–ø–ø—ã –æ–±—ä–µ–∫—Ç–æ–≤
- –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ —É–ø—Ä–æ—Å—Ç–∏—Ç—å –º–æ–¥–µ–ª—å –¥–æ–º–µ–Ω–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏, —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—è —Å–ª–æ–∂–Ω—É—é –≤–∑–∞–∏–º–æ—Å–≤—è–∑–∞–Ω–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–∞–∫ –µ–¥–∏–Ω–æ–µ —Ü–µ–ª–æ–µ
- –ö–æ–≥–¥–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ –≥—Ä—É–ø–ø–µ –æ–±—ä–µ–∫—Ç–æ–≤ —á–µ—Ä–µ–∑ –µ–¥–∏–Ω—É—é —Ç–æ—á–∫—É –≤—Ö–æ–¥–∞

### üëç –ü–ª—é—Å—ã –∏ üëé –ú–∏–Ω—É—Å—ã

| –ü–ª—é—Å—ã | –ú–∏–Ω—É—Å—ã |
|-------|--------|
| –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –∏ —Å–æ–±–ª—é–¥–µ–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª | –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —Ä–∞–∑–¥—É—Ç—ã–º –æ–±—ä–µ–∫—Ç–∞–º, –µ—Å–ª–∏ –≥—Ä–∞–Ω–∏—Ü—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ |
| –£–ø—Ä–æ—â–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—É—é –ª–æ–≥–∏–∫—É | –¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≥—Ä–∞–Ω–∏—Ü –∞–≥—Ä–µ–≥–∞—Ç–æ–≤ |
| –ó–∞—â–∏—â–∞–µ—Ç –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–æ–º–µ–Ω–∞ | –°–ª–∏—à–∫–æ–º –∫—Ä—É–ø–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã –º–æ–≥—É—Ç –Ω–µ–≥–∞—Ç–∏–≤–Ω–æ –≤–ª–∏—è—Ç—å –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å |
| –ü–æ–≤—ã—à–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏–∏ | –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã —Å –æ–±—ä–µ–∫—Ç–∞–º–∏, –µ—Å–ª–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–æ—Ä–Ω—è –Ω–µ –ø—Ä–æ–¥—É–º–∞–Ω |
| –î–µ–ª–∞–µ—Ç –¥–æ–º–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å –±–æ–ª–µ–µ –ø–æ–Ω—è—Ç–Ω–æ–π | –¢—Ä–µ–±—É–µ—Ç –≥–ª—É–±–æ–∫–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è –ø—Ä–µ–¥–º–µ—Ç–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ |